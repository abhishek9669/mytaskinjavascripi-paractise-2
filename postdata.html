<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Post Data</h1>
        <form id="myaddform" class="myform" >
            <div class="mb-3 myform2 invisible">
                <label for="exampleInputId" class="form-label ">id</label>
                <input type="number" name="id" class="form-control r_id" id="exampleInputId">
            </div>
            <div class="mb-3 myform2">
                <label for="exampleInputName" class="form-label ">Name</label>
                <input type="text" name="name" class="form-control r_Edit1" id="exampleInputName">
            </div>
            <div class="mb-3 myform2">
                <label for="exampleInputEmail" class="form-label">Email</label>
                <input type="email" name="email" class="form-control r_Edit2" id="exampleInputEmail">
            </div>
            <div class="mb-3 myform2">
                <label for="exampleInputPassword" class="form-label">Password</label>
                <input type="password" name="password" class="form-control r_Edit3" id="exampleInputPassword">
            </div>
            
        
            <button type="submit" class="btn btn-primary col-12 R_submit a_update R_update" data-mydata="mydata">Submit</button><br><br>
            <!-- <button type="submit" class=+"btn btn-primary col-12 a_update invisible"  data-mydata="mydata">Update</button> -->
        </form>
        <br>
        <hr>

        <h1 class="text-center">GET Data</h1>

        <div class="d-flex justify-content-center myspinner" id ="myspinner">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <hr>

        <table class="table">
            <thead>
                <tr>
                    <th>id</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Password</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            
            </tbody>
        </table> 
    </div>
    <script>
         var baseUrl = "https://mycruddjangoapp.herokuapp.com";

       new Promise((resolve, reject) => {
        document.getElementById("myspinner").classList.remove("invisible");
             axios.get(baseUrl + '/api/user/').then((re) => {
                 console.log(re)
                 if (re.status == 200) {
                     resolve(re.data);
                     
                 }else{
                     reject('error');
                 }
             })

         })
         .then((response) => {
            var tr = "";
             console.log(response)
             response.forEach(e=>{
                 tr = tr + `
                 <tr>
                   <td>`+e.id+`</td>
                   <td>`+e.name+`</td>
                   <td>`+e.email+`</td>
                   <td>`+e.password+`</td>
                   <td>
                    <button class="btn btn-primary">edit</button>
                    <button class="btn btn-danger">delete</button>
                   </td>
                 </tr>
                 `

             })
             document.querySelector("table > tbody").innerHTML = tr;
             document.getElementById("myspinner").classList.add("invisible");
         }).catch((err) => {
             console.log(err)
         })
         document.getElementById("myaddform").onsubmit = (e)=>{
             e.preventDefault();
            let name = document.getElementById("exampleInputName").value;
            let email = document.getElementById("exampleInputEmail").value;
            let password = document.getElementById("exampleInputPassword").value;

            let data = {
                "name": name,
                "email": email,
                "password": password
            }

            fetch(baseUrl + "/api/user/",{
                method:"POST",
                headers: {
                    'Accept': 'application/json, text/plain',
                            'Content-Type': 'application/json;charset=UTF-8'
                },
                body:JSON.stringify(data)
            }).then((res)=>{
                console.log(res)
            }).catch((err)=>{console.log(err)})
            

         }

        

    </script>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</html>